/*! mudHowlers - v0.1.0 - 2015-04-07 */angular.module("mudHowlers").directive("getContent",["$firebase","$window","$state","$timeout",function(a,b,c,d){return{restrict:"A",scope:!1,link:function(b,c,e){b.totalPosts=0,b.startValue=0,b.end=0,b.limit=1,b.isLoading=!0,b.buttonDisabled=!0,b.lastOneIn=!1;var f="https://mudhowlers.firebaseio.com/posts/",g="https://mudhowlers.firebaseio.com/"+e.getContent+"/posts/";b.posts=[],b.postsArray=[],b.landscapeSizes=[{height:"618px"},{height:"410px"},{height:"305px"},{height:"200px"}],b.portraitSizes=[{height:"931px"},{height:"696px"},{height:"460px"}],b.socialSizes=[{height:"615px"},{height:"460px"},{height:"302px"},{height:"226px"}],b.getTotal=function(){var c=a(new Firebase("https://mudhowlers.firebaseio.com/"+e.getContent+"/priorityCounter/")).$asObject();c.$loaded().then(function(a){b.totalPosts=a.$value;for(var c=3;c<=b.totalPosts;c++)b.totalPosts%c===0&&(b.limit=c,c=b.totalPosts+1);b.end=a.$value-1,b.startValue=b.end-(b.limit-1),b.getData()})},b.animatePosts=function(){if(void 0!==c[0].children[0]){var a=angular.element(document.getElementsByClassName("entering"));d(function(){a.removeClass("entering"),a.addClass("arrived")},100)}},b.getData=function(){if(b.lastOneIn===!1){b.postsArray=[],b.posts=[];var c,d;c=new Firebase(g).orderByPriority().startAt(b.startValue).limitToFirst(b.limit),b.postsArray=a(c).$asArray(),b.postsArray.$loaded().then(function(c){angular.forEach(c,function(c){0===c.$priority&&(b.lastOneIn=!0),d=a(new Firebase(f+c.$id)).$asObject(),d.$loaded().then(function(a){console.log(a),b.posts.push(a),b.checkIfReachedLimit()})})}),void 0!=b.postsArray[0]&&b.postsArray.$destroy(),b.startValue-=b.limit}else b.buttonDisabled=!1},b.checkIfReachedLimit=function(){b.posts.length>=b.limit&&(angular.forEach(b.posts,function(){b.displayData()}),b.animatePosts())},b.displayData=function(){b.isLoading=!1,b.posts.reverse(),angular.forEach(b.posts,function(a){if(a.status===!0){if(c.append("<div class='newPost'></div>"),b.surrogateObj=a,b.element=angular.element(document.getElementsByClassName("newPost")),b.element.addClass("entering"),b.element.addClass("canTransform"),"Video"==b.surrogateObj.contentType)b.element.addClass("post"),b.element.addClass("sixteen columns"),b.element.css({"margin-bottom":"10px",height:"552px","float":"left"}),b.element.append("<iframe width='100%' height='100%' src='http://www.youtube.com/embed/"+b.surrogateObj.content+"'></iframe>");else{var d=b.surrogateObj.heriarchy,e=b.surrogateObj.contentType;switch(b.element.addClass("post"),b.surrogateObj.contentPresentation){case"Landscape":1==d&&b.element.addClass("sixteen columns"),2==d&&b.element.addClass("two-thirds column"),3==d&&b.element.addClass("eight columns"),4==d&&b.element.addClass("one-third column"),"Imagen"==e?(b.element.css({"margin-bottom":"10px",height:b.landscapeSizes[d-1].height,"background-image":"url("+b.surrogateObj.content+")","background-position":"center center","background-size":"cover","z-index":"-1","float":"left",position:"relative"}),b.element.append("<div class='hoverBlock'></div>"),b.element.append("<h1 class='image-title'>"+b.surrogateObj.title+"</h1>"),b.element.append("<p class='image-author'> <span>Posted by</span><br>"+b.surrogateObj.author+"</p>"),b.element.append("<p class='image-date'> <span>Date</span><br> "+b.surrogateObj.dateDay+"."+b.surrogateObj.dateMonth+"."+b.surrogateObj.dateYear+"</p>")):"Texto"==e&&(b.element.css({"margin-bottom":"10px",height:b.landscapeSizes[d-1].height,"z-index":"-1","float":"left",position:"relative"}),b.element.append("<h1 class='post-title'>"+b.surrogateObj.title+"</h1>"),b.element.append("<p class='post-content'>"+b.surrogateObj.content+"</p>"),b.element.append("<p class='post-author'> <span>Posted by</span><br>"+b.surrogateObj.author+"</p>"),b.element.append("<p class='post-date'> <span>Date</span><br> "+b.surrogateObj.dateDay+"."+b.surrogateObj.dateMonth+"."+b.surrogateObj.dateYear+"</p>"));break;case"Portrait":1==d&&b.element.addClass("two-thirds column"),2==d&&b.element.addClass("eight columns"),3==d&&b.element.addClass("one-third column"),"Imagen"==e?(b.element.css({"margin-bottom":"10px",height:b.portraitSizes[d-1].height,"background-image":"url("+b.surrogateObj.content+")","background-position":"center center","background-size":"cover","z-index":"-1","float":"left",position:"relative"}),b.element.append("<div class='hoverBlock'></div>"),b.element.append("<h1 class='image-title'>"+b.surrogateObj.title+"</h1>"),b.element.append("<p class='image-author'> <span>Posted by</span><br>"+b.surrogateObj.author+"</p>"),b.element.append("<p class='image-date'> <span>Date</span><br> "+b.surrogateObj.dateDay+"."+b.surrogateObj.dateMonth+"."+b.surrogateObj.dateYear+"</p>")):"Texto"==e&&(b.element.css({"margin-bottom":"10px",height:b.portraitSizes[d-1].height,"z-index":"-1","float":"left",position:"relative"}),b.element.append("<h1 class='post-title'>"+b.surrogateObj.title+"</h1>"),b.element.append("<p class='post-content'>"+b.surrogateObj.content+"</p>"),b.element.append("<p class='post-author'> <span>Posted by</span><br>"+b.surrogateObj.author+"</p>"),b.element.append("<p class='post-date'> <span>Date</span><br> "+b.surrogateObj.dateDay+"."+b.surrogateObj.dateMonth+"."+b.surrogateObj.dateYear+"</p>"));break;case"Social":1==d&&b.element.addClass("two-thirds column"),2==d&&b.element.addClass("eight columns"),3==d&&b.element.addClass("one-third column"),4==d&&b.element.addClass("four columns"),"Imagen"==e?(b.element.css({"margin-bottom":"10px",height:b.socialSizes[d-1].height,"background-image":"url("+b.surrogateObj.content+")","background-position":"center center","background-size":"cover","z-index":"-1","float":"left",position:"relative"}),b.element.append("<div class='hoverBlock'></div>"),b.element.append("<h1 class='image-title'>"+b.surrogateObj.title+"</h1>"),b.element.append("<p class='image-author'> <span>Posted by</span><br>"+b.surrogateObj.author+"</p>"),b.element.append("<p class='image-date'> <span>Date</span><br> "+b.surrogateObj.dateDay+"."+b.surrogateObj.dateMonth+"."+b.surrogateObj.dateYear+"</p>")):"Texto"==e&&(b.element.css({"margin-bottom":"10px",height:b.socialSizes[d-1].height,"z-index":"-1","float":"left",position:"relative"}),b.element.append("<h1 class='post-title'>"+b.surrogateObj.title+"</h1>"),b.element.append("<p class='post-content'>"+b.surrogateObj.content+"</p>"),b.element.append("<p class='post-author'> <span>Posted by</span><br>"+b.surrogateObj.author+"</p>"),b.element.append("<p class='post-date'> <span>Date</span><br> "+b.surrogateObj.dateDay+"."+b.surrogateObj.dateMonth+"."+b.surrogateObj.dateYear+"</p>"))}}b.element.removeClass("newPost"),b.posts=[]}})},b.getTotal()}}}]);